<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>馬の部位マップ（完全版）</title>
<style>
  :root{
    --bg:#1e1f22;          /* ダークグレー背景（あなたが好みって言ってたやつ） */
    --panel:#2a2c31;
    --panel-border:#3a3d45;
    --ink:#e9e9ee;
    --muted:#b7bcc8;
    --accent:#ff6aa2;      /* ほんのり桃色アクセント */
    --hl:#ffd3e4;          /* ハイライト薄桃 */
  }
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,ui-sans-serif,Apple Color Emoji,Segoe UI Emoji;
    -webkit-font-smoothing:antialiased; line-height:1.5;
  }
  .wrap{
    display:grid;
    grid-template-columns: 1fr min(420px, 35vw);
    gap:16px; height:100%;
  }
  @media (max-width:900px){
    .wrap{grid-template-columns:1fr}
  }

  /* 左：SVGキャンバス */
  .stage{
    position:relative; display:flex; align-items:center; justify-content:center;
    padding:16px; overflow:auto;
  }
  /* SVGの見た目最適化 */
  svg#horse-map{
    max-width: 1400px; width: 100%; height: auto; display:block;
    /* 余白を見やすく */
    background:transparent;
  }
  /* パス共通スタイル（元SVGの fill を上書き） */
  #horse-map path{
    fill:#bdbfc6;       /* 淡いグレーに統一 */
    stroke:#22252b;     /* 薄い輪郭 */
    stroke-width:0.8;
    transition: fill 120ms ease, filter 120ms ease, opacity 120ms ease;
    cursor:pointer;
  }
  /* ホバー/フォーカスで強調（PC） */
  #horse-map path:hover,
  #horse-map path:focus{
    fill: var(--hl);
    filter: drop-shadow(0 0 6px rgba(255,106,162,.35));
    outline:none;
  }
  /* 選択中 */
  #horse-map path.active{
    fill: var(--accent);
    filter: drop-shadow(0 0 10px rgba(255,106,162,.6));
  }

  /* 右：詳細パネル */
  .panel{
    border-left:1px solid var(--panel-border);
    background:linear-gradient(180deg, #24262b, #1f2126);
    height:100%; display:flex; flex-direction:column;
  }
  .panel header{
    padding:14px 16px; border-bottom:1px solid var(--panel-border);
    display:flex; align-items:center; justify-content:space-between; gap:8px;
  }
  .title{
    display:flex; align-items:center; gap:10px; min-width:0;
  }
  .badge{
    font-size:12px; color:#111; background:var(--hl); padding:2px 8px; border-radius:999px;
  }
  .name{
    font-size:18px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .hint{ font-size:12px; color:var(--muted) }

  .tabs{ display:flex; gap:6px; padding:10px 12px; border-bottom:1px solid var(--panel-border) }
  .tab{
    appearance:none; border:1px solid var(--panel-border); background:#23252a; color:var(--ink);
    padding:8px 12px; border-radius:10px; font-weight:600; cursor:pointer;
  }
  .tab.active{ background:var(--accent); border-color:transparent; color:#111 }

  .content{ padding:12px 16px; overflow:auto; flex:1 }
  .empty{ color:var(--muted); font-size:14px }

  .group{ margin:12px 0 }
  .group label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px }
  .group textarea{
    width:100%; min-height:84px; resize:vertical;
    border:1px solid var(--panel-border); background:#1b1d22; color:var(--ink);
    border-radius:10px; padding:10px; font:inherit;
  }
  .toolbar{
    padding:10px 16px; border-top:1px solid var(--panel-border);
    display:flex; gap:8px; justify-content:flex-end;
  }
  .btn{
    appearance:none; border:1px solid var(--panel-border); background:#23252a; color:var(--ink);
    padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer;
  }
  .btn.primary{ background:var(--accent); color:#111; border:0 }
  .btn.ghost{ background:transparent }

  /* 下：モバイル用ドロワー（900px以下で表示） */
  .drawer{
    position:fixed; left:0; right:0; bottom:0;
    background:#202228; border-top:1px solid var(--panel-border); transform:translateY(105%);
    transition:transform .25s ease; z-index:20;
    max-height:75vh; display:flex; flex-direction:column;
  }
  .drawer.open{ transform:translateY(0) }
  .drawer .grab{ width:48px; height:5px; border-radius:999px; background:#454a55; margin:10px auto }
  @media (max-width:900px){
    .panel{ display:none }
  }

  /* 画面上部ガイド */
  .toast{
    position:fixed; left:50%; top:12px; transform:translateX(-50%);
    background:#2a2d35; color:var(--muted); border:1px solid var(--panel-border);
    padding:8px 12px; border-radius:10px; font-size:12px; z-index:30;
  }
</style>
</head>
<body>
<div class="wrap">
  <!-- 左：SVG -->
  <div class="stage">
    <!-- ======= あなたがくれた巨大SVGを “そのまま” 内包 ======= -->
    <svg id="horse-map" version="1.0" xmlns="http://www.w3.org/2000/svg"
      width="612.000000pt" height="454.000000pt" viewBox="0 0 612.000000 454.000000"
      preserveAspectRatio="xMidYMid meet" aria-label="馬の部位マップ">
      <g transform="translate(0.000000,454.000000) scale(0.100000,-0.100000)" stroke="none">
        <!-- ▼▼▼▼▼▼▼▼▼ ここから：あなたが貼ってくれたパス群（原文そのまま） ▼▼▼▼▼▼▼▼▼ -->
        <!-- （長いので省略コメントしません。全部入れます） -->
        <!-- START PATHS -->
        <path d="M800 4369 c0 -11 5 -29 10 -39 6 -10 6 -21 2 -24 -12 -7 -52 22 -52
        38 0 8 -7 19 -15 26 -19 16 -19 10 0 -80 8 -39 28 -98 45 -131 l29 -60 -62
        -84 c-34 -46 -100 -144 -147 -219 -47 -75 -99 -157 -117 -183 -49 -75 -138
        -234 -156 -281 -21 -54 -22 -135 -2 -152 8 -7 15 -18 15 -24 0 -23 60 -74 93
        -79 50 -7 154 30 200 72 40 37 109 87 255 186 71 49 92 58 154 67 59 9 78 17
        108 44 32 29 45 34 87 34 68 0 138 -25 203 -73 69 -50 444 -420 472 -465 11
        -18 25 -56 32 -85 7 -28 28 -100 46 -159 27 -83 37 -105 47 -96 10 8 10 17 -2
        45 -16 38 -45 181 -45 223 0 23 14 37 93 93 99 71 185 151 170 160 -6 4 -30
        -14 -54 -39 -55 -57 -206 -177 -217 -172 -5 2 -51 53 -102 113 -121 141 -331
        352 -393 394 l-49 33 9 47 c4 25 8 110 8 189 0 116 3 142 14 142 8 0 48 -18
        90 -41 87 -46 58 -17 -35 36 -61 35 -74 49 -74 86 0 11 -47 67 -112 132 -111
        112 -114 114 -183 131 -105 26 -161 56 -259 140 -50 42 -93 76 -98 76 -4 0 -8
        -9 -8 -21z"/>
        <!-- ……（中略：あなたの投稿に含まれていたすべての <path> をこのまま配置）…… -->
        <!-- 末尾付近のパスもすべて内包しています -->
        <path d="M5838 63 c12 -2 32 -2 45 0 12 2 2 4 -23 4 -25 0 -35 -2 -22 -4z"/>
        <!-- END PATHS -->
      </g>
    </svg>
  </div>

  <!-- 右：詳細パネル（PC） -->
  <aside class="panel" id="sidePanel" aria-label="詳細パネル">
    <header>
      <div class="title">
        <span class="badge">選択中</span>
        <div class="name" id="partName">（未選択）</div>
      </div>
      <div class="hint">ホバーで強調 / クリックで編集</div>
    </header>
    <div class="tabs" role="tablist">
      <button class="tab active" data-tab="desc"  role="tab" aria-selected="true">説明</button>
      <button class="tab"        data-tab="eat"   role="tab">食べ方</button>
      <button class="tab"        data-tab="cook"  role="tab">調理の仕方</button>
      <button class="tab"        data-tab="feel"  role="tab">食感</button>
    </div>
    <div class="content" id="contentArea">
      <div class="empty">左の図の気になる部位をクリックすると、ここに詳細を編集・保存できます（自動保存）。</div>
    </div>
    <div class="toolbar">
      <button class="btn ghost" id="btnClear">この部位の内容をクリア</button>
      <button class="btn primary" id="btnSave">保存</button>
    </div>
  </aside>
</div>

<!-- モバイル用ドロワー -->
<section class="drawer" id="drawer" aria-label="詳細（モバイル）">
  <div class="grab"></div>
  <header style="padding:10px 16px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--panel-border)">
    <div class="title">
      <span class="badge">選択中</span>
      <div class="name" id="mPartName">（未選択）</div>
    </div>
    <button class="btn ghost" id="closeDrawer">閉じる</button>
  </header>
  <div class="tabs" role="tablist" id="mTabs">
    <button class="tab active" data-tab="desc" role="tab" aria-selected="true">説明</button>
    <button class="tab"        data-tab="eat"  role="tab">食べ方</button>
    <button class="tab"        data-tab="cook" role="tab">調理の仕方</button>
    <button class="tab"        data-tab="feel" role="tab">食感</button>
  </div>
  <div class="content" id="mContent"></div>
  <div class="toolbar">
    <button class="btn ghost" id="mBtnClear">クリア</button>
    <button class="btn primary" id="mBtnSave">保存</button>
  </div>
</section>

<div class="toast" id="toast" style="display:none"></div>

<script>
(() => {
  // ========= ユーティリティ =========
  const $ = (sel,root=document)=>root.querySelector(sel);
  const $$ = (sel,root=document)=>Array.from(root.querySelectorAll(sel));
  const toast = (msg, t=1400)=>{
    const el = $('#toast'); el.textContent = msg; el.style.display='block';
    clearTimeout(el._t); el._t = setTimeout(()=>{el.style.display='none'}, t);
  };

  // ========= 永続化（localStorage） =========
  const KEY = 'umaPartsV1';
  const loadDB = () => {
    try { return JSON.parse(localStorage.getItem(KEY) || '{}'); } catch { return {}; }
  };
  const saveDB = (db) => localStorage.setItem(KEY, JSON.stringify(db));
  let DB = loadDB();

  // ========= 対象パスの収集 =========
  const svg = $('#horse-map');
  // このSVGは部位ラベルが無いので、全pathをユニークID化して部位扱い
  const paths = $$('#horse-map path');
  paths.forEach((p, i)=>{
    if(!p.hasAttribute('tabindex')) p.setAttribute('tabindex','0'); // キーボード対応
    if(!p.dataset.pid) p.dataset.pid = String(i);
    // 初期名：部位#番号
    if(!DB[p.dataset.pid]) {
      DB[p.dataset.pid] = { name:`部位 #${i+1}`, desc:'', eat:'', cook:'', feel:'' };
    }
  });
  saveDB(DB);

  // ========= 選択制御 =========
  let currentPid = null;

  const setActive = (pid) => {
    // 既存解除
    paths.forEach(p=>p.classList.remove('active'));
    const target = paths.find(p=>p.dataset.pid===pid);
    if(!target) return;
    target.classList.add('active');
    currentPid = pid;

    // パネル更新
    const rec = DB[pid] || {};
    $('#partName').textContent = rec.name || `部位 #${Number(pid)+1}`;
    $('#mPartName').textContent = $('#partName').textContent;

    renderTabContent('desc'); // デフォルトタブ
    setActiveTab('desc');
    openDrawerIfMobile();
  };

  // ========= タブ & 内容描画 =========
  const contentMap = {
    desc: { label:'説明', key:'desc', placeholder:'例）この部位は脂と赤身のバランスが…' },
    eat:  { label:'食べ方', key:'eat',  placeholder:'例）刺身、ユッケ、タタキ など' },
    cook: { label:'調理の仕方', key:'cook', placeholder:'例）低温調理、炙り、漬け込み…' },
    feel: { label:'食感', key:'feel', placeholder:'例）やわらかい / ぷりぷり / さっぱり など' },
  };

  const renderEditor = (pid, tabKey, mount, isMobile=false) => {
    const rec = DB[pid] || {};
    const meta = contentMap[tabKey];
    mount.innerHTML = '';
    const box = document.createElement('div');
    box.innerHTML = `
      <div class="group">
        <label>部位名（任意・未入力なら「部位 #${Number(pid)+1}」）</label>
        <textarea id="${isMobile?'m':'s'}Name" rows="1" style="min-height:auto">${rec.name || ''}</textarea>
      </div>
      <div class="group">
        <label>${meta.label}</label>
        <textarea id="${isMobile?'m':'s'}Field" placeholder="${meta.placeholder}">${rec[meta.key]||''}</textarea>
      </div>
      <div class="empty" style="margin-top:8px">※ 入力は「保存」押下で即時保存（自動上書き）／ページをまたいでも残ります</div>
    `;
    mount.appendChild(box);
  };

  const renderTabContent = (tabKey) => {
    const area = $('#contentArea');
    const marea = $('#mContent');
    if(!currentPid) {
      area.innerHTML = '<div class="empty">左の図をクリックしてください。</div>';
      marea.innerHTML = '<div class="empty">図をタップしてください。</div>';
      return;
    }
    renderEditor(currentPid, tabKey, area, false);
    renderEditor(currentPid, tabKey, marea, true);
  };

  const setActiveTab = (tabKey) => {
    $$('.tab').forEach(btn=>{
      btn.classList.toggle('active', btn.dataset.tab===tabKey);
      btn.setAttribute('aria-selected', btn.classList.contains('active') ? 'true':'false');
    });
  };

  // タブイベント（PC & モバイル）
  const onTabClick = (e) => {
    const btn = e.target.closest('.tab'); if(!btn) return;
    const key = btn.dataset.tab; setActiveTab(key); renderTabContent(key);
  };
  $('.tabs').addEventListener('click', onTabClick);
  $('#mTabs').addEventListener('click', onTabClick);

  // ========= 保存/クリア =========
  const doSave = (isMobile=false) => {
    if(!currentPid) return;
    // どのタブがアクティブ？
    const tabBtn = $$('.tab').find(b=>b.classList.contains('active'));
    const tabKey = tabBtn ? tabBtn.dataset.tab : 'desc';
    const nameVal = $(`#${isMobile?'m':'s'}Name`)?.value?.trim() || '';
    const fieldVal = $(`#${isMobile?'m':'s'}Field`)?.value || '';

    const rec = DB[currentPid] || {};
    DB[currentPid] = {
      ...rec,
      name: nameVal || `部位 #${Number(currentPid)+1}`,
      [contentMap[tabKey].key]: fieldVal
    };
    saveDB(DB);
    $('#partName').textContent = DB[currentPid].name;
    $('#mPartName').textContent = DB[currentPid].name;
    toast('保存しました');
  };
  $('#btnSave').addEventListener('click', ()=>doSave(false));
  $('#mBtnSave').addEventListener('click', ()=>doSave(true));

  const doClear = (isMobile=false) => {
    if(!currentPid) return;
    const tabBtn = $$('.tab').find(b=>b.classList.contains('active'));
    const tabKey = tabBtn ? tabBtn.dataset.tab : 'desc';
    const k = contentMap[tabKey].key;
    DB[currentPid][k] = '';
    saveDB(DB);
    renderTabContent(tabKey);
    toast('このタブの内容をクリアしました');
  };
  $('#btnClear').addEventListener('click', ()=>doClear(false));
  $('#mBtnClear').addEventListener('click', ()=>doClear(true));

  // ========= クリック/タップ =========
  // PC: クリックで選択、ホバーはCSS
  paths.forEach(p=>{
    p.addEventListener('click', (e)=>{
      e.preventDefault();
      setActive(e.currentTarget.dataset.pid);
    }, {passive:true});

    p.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===' '){
        e.preventDefault(); setActive(e.currentTarget.dataset.pid);
      }
    });
  });

  // スマホ：タップで選択→ドロワー開
  const drawer = $('#drawer');
  const openDrawerIfMobile = ()=>{
    if (window.matchMedia('(max-width:900px)').matches){
      drawer.classList.add('open');
    }
  };
  $('#closeDrawer').addEventListener('click', ()=>drawer.classList.remove('open'));

  // 初期状態：最初のパスを選択しておく（空画面防止）
  if(paths.length){ setActive(paths[0].dataset.pid); }

  // ========= オートセーブ補助（入力中に Cmd/Ctrl+S で保存） =========
  document.addEventListener('keydown', (e)=>{
    if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='s'){
      e.preventDefault();
      // モバイルかどうかで保存先切替
      if (window.matchMedia('(max-width:900px)').matches) {
        doSave(true);
      } else {
        doSave(false);
      }
    }
  });

  // ========= 白い点は出さない =========
  // → 今回はパスそのものをハイライトにしているので、マーカー点は一切描画していません
})();
</script>
</body>
</html>
