<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>馬肉 部位図（ズレ対策・完全修正版）</title>
<style>
  :root{
    --bg:#fdeef0; --card:#fff; --ink:#d6336c; --hi:rgba(255,0,120,.28); --hi2:rgba(255,0,120,.45);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#222;font-family:"Yu Gothic","Hiragino Sans",sans-serif;}
  .wrap{max-width:1200px;margin:28px auto;padding:0 18px;display:grid;grid-template-columns:minmax(300px,1fr) 360px;gap:24px}
  .stage{background:#fff6;border-radius:14px;padding:12px;display:flex;justify-content:center;align-items:center}
  .panel{background:var(--card);border-radius:14px;box-shadow:0 2px 10px #0001;padding:18px}
  .panel h2{margin:0 0 8px;color:var(--ink);border-bottom:2px solid #f7b1b8;display:inline-block}
  .tip{color:#666;font-size:12px}
  svg{width:100%;height:auto;display:block}
  .part{fill:var(--hi);cursor:pointer;transition:.15s}
  .part:hover{fill:var(--hi2)}
  .handle{display:none;fill:#fff;stroke:#f06;stroke-width:1.6}
  .is-edit .handle{display:block}
  @media (max-width:960px){ .wrap{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="wrap">
  <div class="stage">
    <!-- 画像と当たり判定を同じviewBox上で描く（612×454に固定）-->
    <svg id="map" viewBox="0 0 612 454" aria-label="馬肉部位図" role="img">
      <!-- 元画像（SVG）をimageタグで埋め込み：ここはあなたのファイル名のまま -->
      <image href="screenshot-2025-10-20-203144.svg" x="0" y="0" width="612" height="454" preserveAspectRatio="xMidYMid meet"></image>

      <!-- ↓↓↓ 当たり矩形（viewBox座標で定義：縮尺してもズレない） -->
      <!-- ※初期値は“だいたい”合わせてある。あとで微調整は下のareasを変えるだけ -->
      <rect class="part" data-name="たてがみ"/>
      <rect class="part" data-name="ネック"/>
      <rect class="part" data-name="肩ロース"/>
      <rect class="part" data-name="ロース"/>
      <rect class="part" data-name="ヒレ"/>
      <rect class="part" data-name="前バラ"/>
      <rect class="part" data-name="バラ"/>
      <rect class="part" data-name="後バラ"/>
      <rect class="part" data-name="内モモ"/>
      <rect class="part" data-name="外モモ"/>
      <rect class="part" data-name="イチボ"/>
      <rect class="part" data-name="ランプ"/>
      <rect class="part" data-name="ラム"/>
      <rect class="part" data-name="ブリスケ"/>
      <rect class="part" data-name="肩バラ"/>
      <rect class="part" data-name="フロント"/>
      <rect class="part" data-name="スネ"/>
      <!-- 編集用の白点（?edit=1で表示） -->
      <circle class="handle" r="4"></circle>
    </svg>
  </div>

  <aside class="panel">
    <h2 id="title">馬肉 部位図</h2>
    <p class="tip">部位にカーソル / タップで説明表示。</p>
    <div id="desc">部位を選択してください。</div>
  </aside>
</div>

<script>
/**
 * ■ コア修正ポイント
 *  - 当たり判定は viewBox(612×454) の座標で定義。=> 画像の拡大縮小に影響されずズレない
 *  - スマホの tap 反応も付与
 *  - ?edit=1 で白い点（現在位置）が出る（本番では出ない）
 */

const partsInfo = {
  "たてがみ":"ぷるぷる食感。コラーゲン豊富。赤身と合わせてバランス◎。",
  "ネック":"昔ながらの赤身。噛むほど旨い。ユッケや煮込みに。",
  "肩ロース":"ほどよいサシで柔らか。刺身・すき焼き向き。",
  "ロース":"赤身と脂のバランスが良い定番部位。馬刺しに。",
  "ヒレ":"最も柔らかい希少部位。上品な味わい。",
  "前バラ":"コクのある脂身。焼きや煮込みに。",
  "バラ":"旨みが強い。煮込み料理にも◎。",
  "後バラ":"赤身と脂が層になり、味わい深い。",
  "内モモ":"しっとり赤身。低脂肪でヘルシー。",
  "外モモ":"やや歯ごたえ。噛むほど旨み。",
  "イチボ":"希少。赤身×脂のバランス良。焼きにも。",
  "ランプ":"腰〜尻の赤身。濃い旨み。",
  "ラム":"腰部の柔らか赤身。刺身・焼きOK。",
  "ブリスケ":"肩下の筋肉質。煮込みでとろける。",
  "肩バラ":"脂のコクが強い。焼肉・煮込みに。",
  "フロント":"前脚つけ根。濃厚でスジ煮込みに。",
  "スネ":"スジが多いが長時間煮込みでトロトロ。"
};

// ===== viewBox座標（612×454）での矩形（x,y,w,h） =====
// ※初期合わせ。もっとドンピシャにしたくなったらここを触るだけ
const areas = {
  "たてがみ": {x:130, y:80,  w:185, h:48},
  "ネック"  : {x:205, y:140, w:210, h:90},
  "肩ロース": {x:305, y:135, w:140, h:75},
  "ロース"  : {x:430, y:155, w:150, h:65},
  "ヒレ"    : {x:450, y:228, w:125, h:52},
  "前バラ"  : {x:350, y:255, w:125, h:65},
  "バラ"    : {x:380, y:290, w:150, h:70},
  "後バラ"  : {x:505, y:255, w:120, h:65},
  "内モモ"  : {x:612-190, y:235, w:85,  h:85}, // 右脚付け根内側
  "外モモ"  : {x:612-170, y:175, w:85,  h:70},
  "イチボ"  : {x:612-185, y:150, w:75,  h:46},
  "ランプ"  : {x:612-220, y:215, w:90,  h:70},
  "ラム"    : {x:612-210, y:120, w:105, h:58},
  "ブリスケ": {x:265, y:225, w:90,  h:82},
  "肩バラ"  : {x:320, y:195, w:115, h:83},
  "フロント": {x:282, y:320, w:72,  h:110},
  "スネ"    : {x:294, y:378, w:60,  h:120}
};

const map = document.getElementById('map');
const parts = [...map.querySelectorAll('.part')];
const edit = new URLSearchParams(location.search).get('edit') === '1';
if (edit) document.body.classList.add('is-edit');

const title = document.getElementById('title');
const desc  = document.getElementById('desc');

function paintRects(){
  parts.forEach(r=>{
    const name = r.dataset.name;
    const a = areas[name];
    if (!a) return;
    r.setAttribute('x', a.x);
    r.setAttribute('y', a.y);
    r.setAttribute('width',  a.w);
    r.setAttribute('height', a.h);
  });
  // 編集用白点：最後のcircleを中央に置く（代表点）
  const h = map.querySelector('.handle');
  if (h){
    const a = areas["たてがみ"];
    h.setAttribute('cx', a.x + a.w/2);
    h.setAttribute('cy', a.y + a.h/2);
  }
}

function bindEvents(){
  const activate = (name)=>{
    title.textContent = name;
    desc.textContent  = partsInfo[name] || "説明登録なし。";
  };
  parts.forEach(r=>{
    const name = r.dataset.name;
    const fire = ()=>activate(name);
    r.addEventListener('click', fire);
    r.addEventListener('touchstart', (e)=>{e.preventDefault(); fire();}, {passive:false});
  });
}

paintRects();
bindEvents();

/* --- ここから下は「微調整を一瞬でやる用」：本番動作には影響なし ------------------
   ?nudge=1 で起動。矩形の上にカーソルを置き、矢印キーで1px、Shift+矢印で5px移動。
   位置は console に出すだけ（必要なら値をここに貼り戻せばOK）。
---------------------------------------------------------------------------- */
const nudge = new URLSearchParams(location.search).get('nudge') === '1';
if (nudge){
  let current = null;
  parts.forEach(el=>{
    el.addEventListener('mouseenter',()=> current = el);
    el.addEventListener('mouseleave',()=> current = null);
  });
  window.addEventListener('keydown',e=>{
    if(!current) return;
    const a = areas[current.dataset.name];
    const step = e.shiftKey ? 5 : 1;
    if (e.key === 'ArrowLeft')  a.x -= step;
    if (e.key === 'ArrowRight') a.x += step;
    if (e.key === 'ArrowUp')    a.y -= step;
    if (e.key === 'ArrowDown')  a.y += step;
    paintRects();
    console.log(current.dataset.name, a);
  });
}
</script>
</body>
</html>
