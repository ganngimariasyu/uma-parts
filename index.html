<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ é¦¬ã®éƒ¨ä½ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è§£èª¬</title>
  <meta name="description" content="é¦¬ã®éƒ¨ä½ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€èª¬æ˜ãƒ»é£Ÿã¹æ–¹ãƒ»èª¿ç†ã®ä»•æ–¹ãƒ»é£Ÿæ„Ÿã€ãŒãã®å ´ã§è¡¨ç¤ºã•ã‚Œã‚‹ãƒ¯ãƒ³ãƒšãƒ¼ã‚¸å®Œçµãƒ„ãƒ¼ãƒ«ã€‚" />
  <style>
    :root{
      --bg:#0c1020; --card:#12192b; --ink:#e9f1ff; --muted:#9eb0d1; --accent:#6ea8ff; --ok:#a6ffb1; --warn:#ffd27a;
      --panel:#0f1526; --line:#223155; --hit:#5db0ff55; --sel:#6ea8ff99;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      background:linear-gradient(180deg, #0b1020 0%, #0a0f1e 100%); color:var(--ink);
    }
    header{padding:20px 16px 8px;}
    h1{margin:0 0 4px; font-size:clamp(20px,3vw,28px); letter-spacing:0.02em}
    .sub{color:var(--muted); font-size:14px}

    .wrap{display:grid; grid-template-columns:1.2fr 1fr; gap:16px; padding:12px 16px 24px; max-width:1200px; margin:auto}
    @media (max-width: 960px){ .wrap{ grid-template-columns:1fr; } }

    .stage{background:var(--card); border:1px solid var(--line); border-radius:18px; padding:12px; position:relative;}
    .legend{display:flex; gap:8px; flex-wrap:wrap; padding:8px 8px 0;}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#0d1426; border:1px solid var(--line); color:var(--muted); font-size:12px}
    .badge i{width:10px; height:10px; border-radius:2px; background:var(--accent); display:inline-block}

    /* SVG area */
    .svgbox{position:relative; aspect-ratio: 16/9; width:100%; background:radial-gradient(1200px 600px at 50% 10%, #11203b 0%, #0c1324 40%, #0b1020 100%); border-radius:14px; overflow:hidden; border:1px solid var(--line)}
    svg{display:block; width:100%; height:100%}
    .part{fill:#89a7d944; stroke:#8fb4ff66; stroke-width:1.2; cursor:pointer; transition:all .15s ease}
    .part:hover{fill:var(--hit);}
    .part[aria-selected="true"]{fill:var(--sel); stroke:#bcd6ff;}

    .label{font-size:12px; fill:#cfe1ff; text-shadow:0 1px 0 #0008}

    /* Side panel */
    .panel{position:relative; background:var(--panel); border:1px solid var(--line); border-radius:16px; overflow:hidden}
    .panel header{padding:14px 16px; border-bottom:1px solid var(--line);}
    .panel h2{margin:0; font-size:18px}
    .chip{color:var(--muted); font-size:12px}

    .tabs{display:flex; gap:6px; padding:10px; border-bottom:1px solid var(--line); overflow:auto}
    .tab{flex:0 0 auto; padding:8px 12px; background:#0e1528; border:1px solid var(--line); color:var(--muted); border-radius:10px; cursor:pointer; font-size:13px}
    .tab[aria-selected="true"]{background:#15213a; color:var(--ink); border-color:#34508a}

    .content{padding:14px 16px; min-height:180px}
    .content h3{margin:0 0 6px; font-size:14px; color:var(--muted)}
    .content p{margin:0 0 10px; line-height:1.8}
    .hint{font-size:12px; color:var(--muted); padding:8px 16px 16px}

    /* Footer buttons */
    .foot{display:flex; gap:8px; padding:10px; border-top:1px solid var(--line); background:#0d1426}
    .btn{flex:1; padding:10px 12px; text-align:center; background:#132142; color:var(--ink); border:1px solid #284278; border-radius:12px; cursor:pointer; font-size:14px}
    .btn.secondary{background:#10182d; color:var(--muted)}

    /* Toast */
    .toast{position:fixed; inset:auto 16px 16px auto; background:#101a31; border:1px solid var(--line); color:var(--ink); padding:10px 12px; border-radius:12px; opacity:0; transform:translateY(8px); transition:.2s ease; pointer-events:none}
    .toast.show{opacity:1; transform:translateY(0)}
  </style>
</head>
<body>
  <header>
    <h1>ğŸ´ é¦¬ã®éƒ¨ä½ã‚’ã‚¿ãƒƒãƒ— â–¶ æƒ…å ±ãŒãã®å ´ã§é–‹ã</h1>
    <div class="sub">ãƒšãƒ¼ã‚¸é·ç§»ãªã—ãƒ»ãƒ¯ãƒ³ãƒšãƒ¼ã‚¸å®Œçµã€‚SVGã‚¯ãƒªãƒƒã‚¯ã§ <b>èª¬æ˜ï¼é£Ÿã¹æ–¹ï¼èª¿ç†ã®ä»•æ–¹ï¼é£Ÿæ„Ÿ</b> ã‚’åˆ‡æ›¿è¡¨ç¤ºã€‚</div>
  </header>

  <div class="wrap">
    <!-- å·¦ï¼šã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–SVG -->
    <section class="stage">
      <div class="legend">
        <span class="badge"><i></i> ã‚¿ãƒƒãƒ—ã§é¸æŠï¼ã‚‚ã†ä¸€åº¦ã§è§£é™¤</span>
        <span class="badge"><i style="background:var(--ok)"></i> ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ</span>
        <span class="badge"><i style="background:var(--warn)"></i> ãƒ‡ãƒ¼ã‚¿ã¯å³ãƒ‘ãƒãƒ«ã®ï¼»ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼½ã§æ›´æ–°</span>
      </div>
      <div class="svgbox" id="svgbox">
        <!-- ç°¡æ˜“ã‚·ãƒ«ã‚¨ãƒƒãƒˆï¼ˆå·®ã—æ›¿ãˆOKï¼‰ï¼šéƒ¨ä½ã¯å¤§ã¾ã‹ãªä½ç½®ã‚’ç¤ºã™ãƒ‡ãƒ¢ã€‚å®Ÿé‹ç”¨ã§ã¯æ­£ç¢ºãªSVGã«å·®ã—æ›¿ãˆã¦ãã ã•ã„ã€‚ -->
        <svg viewBox="0 0 900 500" xmlns="http://www.w3.org/2000/svg" aria-labelledby="ttl desc">
          <title id="ttl">é¦¬ã®éƒ¨ä½ã‚·ãƒ«ã‚¨ãƒƒãƒˆï¼ˆãƒ‡ãƒ¢ï¼‰</title>
          <desc id="desc">ã‚·ãƒ«ã‚¨ãƒƒãƒˆä¸Šã®ãƒ‘ãƒ¼ãƒ„ã‚’ã‚¿ãƒƒãƒ—ã—ã¦è©³ç´°ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</desc>

          <!-- ä½“ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆï¼ˆã–ã£ãã‚Šï¼‰ -->
          <path d="M120,220 C180,160 300,130 420,150 C520,165 610,210 700,230 C750,240 790,250 820,280 C780,300 760,330 720,350 C680,370 640,380 600,375 C520,365 460,350 380,350 C320,350 260,360 210,360 C160,360 130,345 110,320 C100,300 98,280 120,220 Z" fill="#0e1730" stroke="#24365e"/>

          <!-- éƒ¨ä½é ˜åŸŸï¼ˆdemoï¼‰-->
          <g id="parts" fill="none">
            <path class="part" data-key="ãƒ­ãƒ¼ã‚¹" d="M300,200 C360,185 430,185 490,195 C520,200 540,210 560,220 C520,230 480,235 440,235 C390,235 350,230 310,220 Z"/>
            <path class="part" data-key="ãƒ’ãƒ¬" d="M510,205 C540,210 565,220 590,235 C560,245 530,248 500,248 C485,240 490,225 510,205 Z"/>
            <path class="part" data-key="ãƒãƒ©" d="M260,230 C330,250 420,260 520,260 C500,280 470,295 420,305 C360,315 300,300 250,275 Z"/>
            <path class="part" data-key="ãƒ•ã‚¿ã‚¨ã‚´" d="M200,240 C240,250 260,265 270,285 C240,290 210,288 190,275 C185,260 188,248 200,240 Z"/>
            <path class="part" data-key="ã‚¿ãƒ†ã‚¬ãƒŸ" d="M250,175 C290,160 340,150 390,148 C350,160 320,175 300,195 C280,192 265,185 250,175 Z"/>
            <path class="part" data-key="å†…ã‚‚ã‚‚" d="M420,310 C470,305 520,300 560,295 C545,320 520,338 485,348 C450,355 420,350 395,335 Z"/>
            <path class="part" data-key="å¤–ã‚‚ã‚‚" d="M560,295 C600,290 640,285 680,280 C675,305 655,325 620,340 C590,350 565,345 545,330 Z"/>
            <path class="part" data-key="ãƒãƒ„" d="M610,245 C635,250 660,255 685,265 C660,272 635,275 610,272 C600,265 600,255 610,245 Z"/>
            <path class="part" data-key="ãƒ¬ãƒãƒ¼" d="M640,270 C670,275 700,285 725,300 C700,305 675,308 650,306 C635,298 635,285 640,270 Z"/>
          </g>

          <!-- ãƒ©ãƒ™ãƒ«ï¼ˆã–ã£ãã‚Šï¼‰ -->
          <g fill="currentColor">
            <text class="label" x="360" y="210">ãƒ­ãƒ¼ã‚¹</text>
            <text class="label" x="535" y="210">ãƒ’ãƒ¬</text>
            <text class="label" x="420" y="280">ãƒãƒ©</text>
            <text class="label" x="215" y="270">ãƒ•ã‚¿ã‚¨ã‚´</text>
            <text class="label" x="300" y="170">ã‚¿ãƒ†ã‚¬ãƒŸ</text>
            <text class="label" x="445" y="330">å†…ã‚‚ã‚‚</text>
            <text class="label" x="595" y="330">å¤–ã‚‚ã‚‚</text>
            <text class="label" x="630" y="260">ãƒãƒ„</text>
            <text class="label" x="690" y="300">ãƒ¬ãƒãƒ¼</text>
          </g>
        </svg>
      </div>
    </section>

    <!-- å³ï¼šæƒ…å ±ãƒ‘ãƒãƒ« -->
    <aside class="panel" id="panel">
      <header>
        <h2 id="partName">éƒ¨ä½ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„</h2>
        <div class="chip" id="chip">â€”</div>
      </header>
      <nav class="tabs" role="tablist" aria-label="æƒ…å ±ã‚¿ãƒ–">
        <button class="tab" role="tab" aria-selected="true" data-tab="desc">èª¬æ˜</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="eat">é£Ÿã¹æ–¹</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="cook">èª¿ç†ã®ä»•æ–¹</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="texture">é£Ÿæ„Ÿ</button>
      </nav>
      <div class="content" id="content">
        <h3>ã‚¬ã‚¤ãƒ‰</h3>
        <p>å·¦ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‹ã‚‰éƒ¨ä½ã‚’é¸ã¶ã¨ã€ã“ã®ã‚¨ãƒªã‚¢ã«å„ç¨®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒšãƒ¼ã‚¸é·ç§»ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        <p>ã‚¹ãƒãƒ›ã§ã¯ãƒ”ãƒ³ãƒã§æ‹¡å¤§ãƒ»ã‚¹ãƒ¯ã‚¤ãƒ—ã§ç§»å‹•ã§ãã¾ã™ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½ï¼‰ã€‚</p>
      </div>
      <div class="hint">â€» è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿ã¯ãƒ•ã‚¡ã‚¤ãƒ«å†…ã® <code>DATA</code> ã§ç·¨é›†ã§ãã¾ã™ã€‚å®Ÿé‹ç”¨ã§ã¯æ­£ç¢ºãªSVGã¨å·®ã—æ›¿ãˆã¦ãã ã•ã„ã€‚</div>
      <div class="foot">
        <button class="btn" id="editBtn">ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</button>
        <button class="btn secondary" id="clearBtn">é¸æŠè§£é™¤</button>
      </div>
    </aside>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ==============================
    // 1) ãƒ‡ãƒ¼ã‚¿è¾æ›¸ï¼ˆã“ã“ã‚’æ›¸ãæ›ãˆã‚Œã°æ–‡è¨€æ›´æ–°OKï¼‰
    // ==============================
    const DATA = {
      "ãƒ­ãƒ¼ã‚¹": {
        desc: "èƒŒä¸­ã®ä¸­å¿ƒä»˜è¿‘ã€‚ç­‹ç¹Šç¶­ãŒãã‚ç´°ã‹ãã€é¦¬åˆºã—ã®ç‹é“éƒ¨ä½ã€‚ã‚¯ã‚»ãŒå°‘ãªãä¸Šå“ã€‚",
        eat: "è–„åˆ‡ã‚Šã§é¦¬åˆºã—ã€‚é†¤æ²¹ï¼‹ç”Ÿå§œï¼ã«ã‚“ã«ãã€ç”˜ã‚ã®ä¹å·é†¤æ²¹ã‚‚å¥½ç›¸æ€§ã€‚",
        cook: "ç«å…¥ã‚Œãªã‚‰è¡¨é¢ã‚’ã‚µãƒƒã¨ç‚™ã‚Šï¼ˆã‚¿ã‚¿ã‚­ï¼‰ã€‚åšåˆ‡ã‚Šã¯ä½æ¸©èª¿ç†ã§ã—ã£ã¨ã‚Šã€‚",
        texture: "æŸ”ã‚‰ã‹ã‚ã§ã—ã£ã¨ã‚Šã€‚èˆŒã®ä¸Šã§ã¨ã‚ã‘ã‚‹ä¸Šè³ªãªèµ¤èº«æ„Ÿã€‚"
      },
      "ãƒ’ãƒ¬": {
        desc: "è…°ã®å†…å´ã«ã‚ã‚‹æœ€ã‚‚æŸ”ã‚‰ã‹ã„èµ¤èº«ã€‚ä¸­å¤®ã®ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³ã¯å¸Œå°‘ã€‚",
        eat: "é¦¬åˆºã—ã®æœ€ä¸Šä½ã€‚å¡©ï¼‹ã”ã¾æ²¹ã‚’å°‘é‡ã§ç”˜ã¿ã‚’å¼•ãç«‹ã¦ã‚‹ã®ã‚‚â—ã€‚",
        cook: "åšã‚ã¯ä½æ¸©èª¿ç†ã€‚ç„¼ããªã‚‰å¼·ç«çŸ­æ™‚é–“ã§ã€‚",
        texture: "éå¸¸ã«ã‚„ã‚ã‚‰ã‹ã„ã€‚ç¹Šç¶­ãŒç´°ã‹ãã‚¹ãƒƒã¨å™›ã¿åˆ‡ã‚Œã‚‹ã€‚"
      },
      "ãƒãƒ©": {
        desc: "ã‚ã°ã‚‰å‘¨ã‚Šã€‚èµ¤èº«ã¨è„‚ã®å±¤ãŒã‚ã‚Šã‚³ã‚¯æ·±ã„ã€‚",
        eat: "åˆºèº«ã®ä»–ã€ç”˜è¾›ãƒ€ãƒ¬ã§æ¼¬ã‘ã¦ä¸¼ã‚„ãƒ¦ãƒƒã‚±é¢¨ã‚‚äººæ°—ã€‚",
        cook: "ç„¼ãã¯è„‚ãŒè½ã¡ã¦ã‚¸ãƒ¥ãƒ¼ã‚·ãƒ¼ã€‚ç…®è¾¼ã¿ã§ã‚‚å‡ºæ±ãŒæ¿ƒã„ã€‚",
        texture: "èµ¤èº«ã®æ—¨å‘³ï¼‹è„‚ã®ã‚³ã‚¯ã€‚ã‚„ã‚„å™›ã¿å¿œãˆã‚ã‚Šã€‚"
      },
      "ãƒ•ã‚¿ã‚¨ã‚´": {
        desc: "çš®ä¸‹è„‚è‚ªã¨èµ¤èº«ãŒä¸‰å±¤ã«ãªã£ãŸå¸Œå°‘éƒ¨ä½ã€‚è¦‹ãŸç›®ãŒâ€œäºŒé‡â€ã«è¦‹ãˆã‚‹ã“ã¨ã‹ã‚‰ã€‚",
        eat: "è–„ãã‚¹ãƒ©ã‚¤ã‚¹ã—ã¦é¦¬åˆºã—ã€‚è¾›å­å‘³å™Œã‚„ç”˜å£é†¤æ²¹ã«åˆã†ã€‚",
        cook: "å†·ã‚„ã—ã¦è„‚ã‚’è½ã¡ç€ã‹ã›ã¦ã‹ã‚‰åˆ‡ã‚‹ã¨ãã‚Œã„ã«ã€‚",
        texture: "ã‚³ãƒªã‚³ãƒªæ„Ÿã¨è„‚ã®ç”˜ã¿ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã€‚"
      },
      "ã‚¿ãƒ†ã‚¬ãƒŸ": {
        desc: "é¦–ã®ãŸã¦ãŒã¿ä¸‹ã®è„‚èº«ï¼ˆã‚³ã‚¦ãƒï¼‰ã€‚å˜ä½“ã‚ˆã‚Šèµ¤èº«ã¨åˆã‚ã›ã‚‹â€œç´…ç™½åˆºã—â€ãŒå®šç•ªã€‚",
        eat: "ãƒ­ãƒ¼ã‚¹ç­‰ã®èµ¤èº«ã¨1:1ã§é‡ã­ã¦ã€‚å¡©ã‚„ç”˜å£é†¤æ²¹ã§ã€‚",
        cook: "åŠå†·å‡ã§è–„ãå¼•ãã¨å´©ã‚Œã«ãã„ã€‚",
        texture: "ã·ã‚‹ã·ã‚‹ãƒ»ã­ã£ã¨ã‚Šã€‚å£æº¶ã‘ãŒè‰¯ã„ã€‚"
      },
      "å†…ã‚‚ã‚‚": {
        desc: "å¾Œè‚¢ã®å†…å´ã€‚è„‚ãŒå°‘ãªãé«˜ã‚¿ãƒ³ãƒ‘ã‚¯ã€‚",
        eat: "ãƒ˜ãƒ«ã‚·ãƒ¼ã«åˆºèº«ï¼ãŸãŸãã€‚ã‚ã•ã³é†¤æ²¹ã‚‚â—ã€‚",
        cook: "ä½æ¸©èª¿ç†ã§ã—ã£ã¨ã‚Šã€‚è–„è¡£ã®ã‚«ãƒ„ã‚‚ç›¸æ€§è‰¯ã—ã€‚",
        texture: "ã—ã£ã‹ã‚Šã‚ã®å™›ã¿å¿œãˆã€‚æ—¨å‘³æ¿ƒã„èµ¤èº«ã€‚"
      },
      "å¤–ã‚‚ã‚‚": {
        desc: "å¾Œè‚¢å¤–å´ã€‚å¤§ããªç­‹è‚‰ã§æ—¨å‘³ã¯æ¿ƒã„ãŒã‚„ã‚„ç¡¬ã‚ã€‚",
        eat: "è–„åˆ‡ã‚Šåˆºã—ã€ãƒ¦ãƒƒã‚±é¢¨ã€æ¼¬ã‘ã€‚",
        cook: "ç¹Šç¶­ã‚’æ–­ã¡åˆ‡ã‚‹ã‚ˆã†ã«ã‚«ãƒƒãƒˆã€‚ç…®è¾¼ã¿ãƒ»ä½ƒç…®ã‚‚ã€‚",
        texture: "ã‚„ã‚„ç¡¬ã‚ã§è‚‰ã€…ã—ã„å™›ã¿å¿ƒåœ°ã€‚"
      },
      "ãƒãƒ„": {
        desc: "å¿ƒè‡“ã€‚é®®åº¦ãŒå‘½ã§ã‚¯ã‚»å°‘ãªã‚ã®äººæ°—ãƒ›ãƒ«ãƒ¢ãƒ³ã€‚",
        eat: "ã”ã¾æ²¹ï¼‹å¡©ã€é…¢å‘³å™Œã€‚è»½ãç‚™ã£ã¦é¦™ã‚Šå‡ºã—ã‚‚ã€‚",
        cook: "è–„åˆ‡ã‚Šã§ã‚µãƒƒã¨ç„¼ãã€‚",
        texture: "ã‚³ãƒªãƒƒã¨å°æ°—å‘³ã‚ˆã„æ­¯å¿œãˆã€‚å™›ã‚€ã»ã©ã«æ—¨å‘³ã€‚"
      },
      "ãƒ¬ãƒãƒ¼": {
        desc: "è‚è‡“ã€‚æ¿ƒåšã§é‰„åˆ†ãƒªãƒƒãƒã€‚â€»ç”Ÿé£Ÿã¯å„è‡ªæ²»ä½“ã®åŸºæº–ã«å¾“ã£ã¦ãã ã•ã„ã€‚",
        eat: "åŠ ç†±æ´¾ã¯ã”ã¾æ²¹å¡©ï¼ç”˜è¾›ãƒ€ãƒ¬ã€‚",
        cook: "è‡­ã¿æŠœãã¯è¡€æŠœãï¼‹ç‰›ä¹³ã€‚ç«å…¥ã‚Œã¯ä¸­å¿ƒãƒ¬ã‚¢å¯„ã‚Šã§ãµã‚ã£ã¨ã€‚",
        texture: "ã­ã£ã¨ã‚Šæ¿ƒå¯†ã€‚åŠ ç†±ã§ã»ã‚ã£ã¨ã»ã©ã‘ã‚‹ã€‚"
      }
    };

    // ==============================
    // 2) åŸºæœ¬UIåˆ¶å¾¡
    // ==============================
    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => [...el.querySelectorAll(q)];

    const partName = $("#partName");
    const chip = $("#chip");
    const content = $("#content");
    const tabs = $$(".tab");
    const parts = $$(".part");
    const editBtn = $("#editBtn");
    const clearBtn = $("#clearBtn");
    const toast = $("#toast");

    let selectedKey = null;
    let activeTab = "desc"; // desc | eat | cook | texture
    let editMode = false;

    function showToast(msg){
      toast.textContent = msg; toast.classList.add("show");
      clearTimeout(showToast.tid); showToast.tid = setTimeout(()=>toast.classList.remove("show"), 1400);
    }

    function renderPanel(){
      if(!selectedKey){
        partName.textContent = "éƒ¨ä½ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„";
        chip.textContent = "â€”";
        content.innerHTML = `<h3>ã‚¬ã‚¤ãƒ‰</h3>
          <p>å·¦ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‹ã‚‰éƒ¨ä½ã‚’é¸ã¶ã¨ã€ã“ã®ã‚¨ãƒªã‚¢ã«å„ç¨®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒšãƒ¼ã‚¸é·ç§»ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>`;
        return;
      }
      const data = DATA[selectedKey];
      partName.textContent = selectedKey;
      chip.textContent = `ã‚¿ãƒ–ï¼š${tabLabel(activeTab)}`;
      const body = (data?.[activeTab] ?? "æœªè¨­å®š").replace(/\n/g, "<br>");

      if(!editMode){
        content.innerHTML = `<h3>${tabLabel(activeTab)}</h3><p>${body}</p>`;
      }else{
        content.innerHTML = `<h3>${tabLabel(activeTab)}ï¼ˆç·¨é›†ï¼‰</h3>
          <textarea id="editor" style="width:100%;min-height:180px;background:#0c1428;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:10px">${escapeHtml(data?.[activeTab] ?? "")}</textarea>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button class="btn" id="saveBtn">ä¿å­˜</button>
            <button class="btn secondary" id="cancelBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          </div>`;
        $("#saveBtn").onclick = () => {
          const v = $("#editor").value;
          if(!DATA[selectedKey]) DATA[selectedKey] = {};
          DATA[selectedKey][activeTab] = v;
          editMode = false; renderPanel();
          showToast("ä¿å­˜ã—ã¾ã—ãŸï¼ˆã“ã®ãƒšãƒ¼ã‚¸å†…ã®ã¿ï¼‰");
        };
        $("#cancelBtn").onclick = () => { editMode = false; renderPanel(); };
      }
    }

    function tabLabel(key){
      return ({desc:"èª¬æ˜", eat:"é£Ÿã¹æ–¹", cook:"èª¿ç†ã®ä»•æ–¹", texture:"é£Ÿæ„Ÿ"})[key] || key;
    }

    function escapeHtml(s){
      return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
    }

    // ãƒ‘ãƒ¼ãƒ„é¸æŠ
    parts.forEach(p=>{
      p.setAttribute("tabindex","0");
      p.addEventListener("click", ()=>toggleSelect(p));
      p.addEventListener("keypress", (e)=>{ if(e.key==="Enter"||e.key===" ") toggleSelect(p); });
      p.addEventListener("mouseenter", ()=>{ if(!selectedKey) chip.textContent = p.dataset.key; });
      p.addEventListener("mouseleave", ()=>{ if(!selectedKey) chip.textContent = "â€”"; });
    });

    function toggleSelect(p){
      const key = p.dataset.key;
      if(selectedKey === key){ // è§£é™¤
        selectedKey = null;
        parts.forEach(x=>x.setAttribute("aria-selected","false"));
        renderPanel();
        return;
      }
      selectedKey = key;
      parts.forEach(x=>x.setAttribute("aria-selected", x===p ? "true":"false"));
      activeTab = "desc"; tabs.forEach(t=>t.setAttribute("aria-selected", t.dataset.tab===activeTab));
      renderPanel();
    }

    // ã‚¿ãƒ–åˆ‡æ›¿
    tabs.forEach(t=>{
      t.addEventListener("click", ()=>{
        activeTab = t.dataset.tab;
        tabs.forEach(x=>x.setAttribute("aria-selected", x===t?"true":"false"));
        renderPanel();
      });
    });

    // ãƒœã‚¿ãƒ³
    editBtn.onclick = ()=>{
      if(!selectedKey){ showToast("å…ˆã«éƒ¨ä½ã‚’é¸æŠã—ã¦ãã ã•ã„"); return; }
      editMode = !editMode; renderPanel();
      editBtn.textContent = editMode ? "ç·¨é›†çµ‚äº†" : "ç·¨é›†ãƒ¢ãƒ¼ãƒ‰";
    };
    clearBtn.onclick = ()=>{ selectedKey=null; parts.forEach(x=>x.setAttribute("aria-selected","false")); renderPanel(); };

    // åˆæœŸæç”»
    renderPanel();
  </script>
</body>
</html>
